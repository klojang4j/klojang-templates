# Klojang Templates

_Klojang Templates_ is a Java templating API written with two goals in mind:

1. Writing templates should be so simple that there is essentially no learning curve.
2. Provide a rich en flexible API for populating the templates that more than
   compensates for their simplicity.

In short: leverage the skills of Java programmers, rather than make them learn what,
in effect, amounts to a whole new language. This solidly places _Klojang Templates_
in the _Zero Logic Templates_ camp of templating approaches, alongside, for example,
[Mustache](http://mustache.github.io/) and on opposite sides of a template engine
like [Thymeleaf](https://www.thymeleaf.org/).

Klojang templates arguably are even simpler than Mustache templates. There are just
five syntactical constructs. Three if you discount for the fact that two of them are
comments-like constructs. Two if you consider that of those three, two are
functionally equivalent (the API user cannot tell whether one construct was used or
the other). Nevertheless, populating a template can be done very efficiently and
elegantly due to a rather unique feature: nested templates.

One appealing feature of Thymeleaf is that the raw, unprocessed templates render just
as well within a browser as the output generated by the Thymeleaf engine. This allows
the static HTML mockups produced by designers to evolve into fully dynamic pages
while at no point entering an "unrenderable" phase. If your company has the financial
and human resources to care about this, _Klojang Templates_ also allows you to create
templates that will render just fine in their raw state.

# Getting Started

To get started with _Klojang Templates_, add the following dependency to you project:

**Maven**:

```xml

<dependency>
    <groupId>org.klojang</groupId>
    <artifactId>klojang-templates</artifactId>
    <version>1.0.0</version>
</dependency>
```

**Gradle**:

```
implementation group: 'org.klojang', name: 'klojang-templates', version: '1.0.0'
```

The **javadocs** for _Klojang Templates_ can be
found [https://klojang4j.github.io/klojang-templates/1/api](https://klojang4j.github.io/klojang-templates/1/api).

## Hello World

```html
<!-- hello.html -->
<html>
<body>
<p>~%greeting%</p>
</body>
</html>
```

```java
import org.klojang.templates.ParseException;
import org.klojang.templates.RenderSession;
import org.klojang.templates.Template;

public class HelloWorld {

  @GET
  @Path("/hello")
  public String hello() throws ParseException {
    Template template = Template.fromResource(getClass(), "/views/hello.html");
    RenderSession session = template.newRenderSession();
    return session.set("greeting", "Hello World").render();
  }

}
```

## Escaping

_Klojang Templates_ is, in fact, not tied to any particular output format. However,
it does provide some extra help in case you are writing HTML templates.

```html
<!-- hello.html -->
<html>
<head>
    <script>
        const greeting = '~%js:greeting%';
    </script>
</head>
<body>
<p>~%html:greeting%</p>
</body>
</html>
```

By default, _Klojang Templates_ does not apply any escaping or formatting to the
values you insert into the template, but you can [configure](https://klojang4j.github.io/klojang-templates/1/api/org.klojang.templates/org/klojang/templates/StringifierRegistry.Builder.html#setDefaultStringifier(org.klojang.templates.Stringifier)) _Klojang Templates_ to
HTML-escape all values by default. You can then omit the `html:` prefix while keeping
the `js:` prefix to override the default behaviour.

The `html:` and `js:` prefixes are examples of so-called
[variable groups](https://klojang4j.github.io/klojang-templates/1/api/org.klojang.templates/org/klojang/templates/VarGroup.html),
which will be covered in greater detail later on.

## Inserting POJOs, Records and Maps

You can set multiple template variables at once by "inserting" non-scalar values into
the template.

```html
<!-- employee.html -->
<html>
<body>
<table>
    <tr>
        <td>First name:</td>
        <td>~%firstName%</td>
    </tr>
    <tr>
        <td>Last name:</td>
        <td>~%lastName%</td>
    </tr>
    <tr>
        <td>Birthdate:</td>
        <td>~%birthDate%</td>
    </tr>
</table>
</body>
</html>
```

```java
public class EmployeeResource {

   @GET
   @Path("/john-pojo")
   public StreamingOutput pojo() throws ParseException {
      Employee employee = new Employee("John", "Smith", LocalDate.of(1980, 6, 13));
      Template template = Template.fromResource(getClass(), "/views/employee.html");
      RenderSession session = template.newRenderSession();
      session.insert(employee);
      return session::render;
   }


   @GET
   @Path("/john-simple")
   public String simple() throws ParseException {
      Template template = Template.fromResource(getClass(), "/views/employee.html");
      return template.newRenderSession()
              .set("firstName", "John")
              .set("lastName", "Smith")
              .set("birthDate", LocalDate.of(1980, 6, 13))
              .render();
    }

}
```

Note that the `pojo()` method returns a method reference to [RenderSession.render(OutputStream)](https://klojang4j.github.io/klojang-templates/1/api/org.klojang.emplates/org/klojang/templates/RenderSession.html#render(java.io.OutputStream)), 
which neatly targets the JAX-RS [StreamingOutput](https://docs.oracle.com/javaee/7/api/javax/ws/rs/core/StreamingOutput.html)
interface.

## Nested Templates

In _Klojang Templates_ templates can be nested inside other templates (ad infinitum
if you like). Why you would want to do such a thing will be explained below. This 
section details the syntax for nested templates.

There are, in fact, two ways to nest one template inside another. One goes by the 
name "inline templates"; the other by the name "included templates". Functionally 
they are completely equivalent. The API cannot tell you whether you are 
populating an inline template or an included template. (Well, actually, it [can](https://klojang4j.github.io/klojang-templates/1/api/org.klojang.templates/org/klojang/templates/Template.html#path()),
but there's not much you can do with this knowledge.)

### Inline Templates

Inline templates, as the name suggests, are defined within the parent template
itself. Here is an example of a template (company-overview), which contains an inline
template (companies), which itself contains an inline template (departments), which
also contains an inline template (employees). For clarity's sake, this is a non-HTML
template.

#### /views/company-overview.txt:
```
This is an overview of our customers:
~%%begin:companies%
    Name .......: ~%name%
    Profits ....: ~%profits%
    Departments:
    ~%%begin:departments%
        Name .......: ~%name%
        Manager ....: ~%manager%
        Employees:
            ~%%begin:employees%
                First name ....: ~%firstName%               
                Last name .....: ~%lastName%               
                Birth date ....: ~%birthDate%               
            ~%%end:employees%
   ~%%end:departments%
~%%end:companies%
Not bad, ey!
```

### Included Templates
Included templates are defined in a separate file and are nested inside another 
template using the following syntax:

#### /views/company-overview.txt:
```
This is an overview of our customers:
~%%begin:companies%
    Name .......: ~%name%
    Profits ....: ~%profits%
    Departments:
        ~%%include:/views/departments.txt%%
~%%end:companies%
Not bad, ey!
```

#### /views/departments.txt:
```
        Name .......: ~%name%
        Manager ....: ~%manager%
        Employees:
            ~%%include:/views/employees.txt%% 
```

#### /views/employees.txt:
```
                First name ....: ~%firstName%               
                Last name .....: ~%lastName%               
                Birth date ....: ~%birthDate%               
```

Nested templates, whether inline or included, are identified by their name. That 
is, when you want to populate them using the API, you do so by specifying their 
name &#8212; "companies", "departments" and "employees" in the examples above. 
For included templates, the name by default is the basename of the included file. 
If this is too rigid, you can use the following syntax:

```
~%%include:employees:/views/employees-2023-01-01.txt%%
```




